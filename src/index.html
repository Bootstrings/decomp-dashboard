<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Melee Decompilation Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./style.css">
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="app-container">
        <!-- ===== Sidebar Navigation ===== -->
        <aside class="sidebar">
            <div class="sidebar-header">Decomp Dashboard</div>
            <nav>
                <a id="nav-setup" class="sidebar-nav-item active">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                    <span>Setup</span>
                </a>
                <a id="nav-decomp" class="sidebar-nav-item disabled">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                    <span>Decompilation</span>
                </a>
                 <a id="nav-build" class="sidebar-nav-item disabled">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path></svg>
                    <span>Build & Verify</span>
                </a>
                <a id="nav-dashboard" class="sidebar-nav-item disabled">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V7a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                    <span>Dashboard</span>
                </a>
                 <a id="nav-refactor" class="sidebar-nav-item disabled">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    <span>AI Refactor</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                 <a id="nav-settings" class="sidebar-nav-item">
                    <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01-.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path></svg>
                    <span>Settings</span>
                </a>
            </div>
        </aside>

        <!-- ===== Main Content Area ===== -->
        <div class="main-content">
            <!-- Header -->
            <header class="content-header flex justify-between items-center">
                <h1 id="view-title" class="text-2xl font-bold text-slate-800">Project Setup</h1>
                <div id="external-links" class="flex space-x-2">
                     <button id="github-link-btn" title="Open Melee Decomp GitHub" class="p-2 rounded-full bg-slate-200 hover:bg-slate-300 transition">
                        <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.67.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                    </button>
                    <button id="decomp-me-link-btn" title="Open decomp.me" class="p-2 rounded-full bg-slate-200 hover:bg-slate-300 transition">
                         <svg width="20" height="20" viewBox="0 0 36 36" fill="currentColor"><defs><mask id="m"><rect width="100%" height="100%" fill="#fff"/><circle cx="14" cy="20" r="1.25" fill="#000"/><circle cx="22" cy="20" r="1.25" fill="#000"/></mask></defs><g><path mask="url(#m)" d="M31.755 12.676A5.99 5.99 0 0 0 34 8a6 6 0 0 0-11.851-1.315A11.8 11.8 0 0 0 18 5.927c-1.465 0-2.861.275-4.149.758A6 6 0 0 0 2 8c0 1.891.877 3.576 2.245 4.676C1.6 15.356 0 18.685 0 22c0 7.456 8.059 1 18 1s18 6.456 18-1c0-3.315-1.6-6.644-4.245-9.324"/><path fill="none" stroke="currentColor" stroke-width="1.75" d="M36 22c0 7.456-8.059 12-18 12S0 29.456 0 22 8.059 7 18 7s18 7.544 18 15"/><circle cx="7.5" cy="7.5" r="3.5" fill="#fff"/><circle cx="7.5" cy="7.5" r="1.5"/><circle cx="28.5" cy="7.5" r="3.5" fill="#fff"/><circle cx="28.5" cy="7.5" r="1.5"/></g></svg>
                    </button>
                </div>
            </header>
            
            <!-- Scrollable Content -->
            <div class="content-scroll-area">
                
                <!-- View: Setup -->
                <div id="view-setup">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-semibold mb-4">Project Environment Setup</h2>
                        <div class="space-y-6">
                            <div>
                                <h3 class="text-lg font-medium text-slate-800 mb-3">1. Select Project Paths</h3>
                                <div class="space-y-4 p-4 bg-slate-50 rounded-lg border border-slate-200">
                                    <div><label for="project-folder" class="block text-sm font-medium text-slate-700 mb-1">Project Folder</label><div class="flex"><input type="text" id="project-folder" class="flex-grow p-2 border border-slate-300 rounded-l-md" placeholder="Select the parent folder where the 'melee' project will be cloned" readonly><button id="select-folder-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-r-md hover:bg-indigo-700">Select Folder</button></div></div>
                                    <div><label for="main-dol-path" class="block text-sm font-medium text-slate-700 mb-1">Path to main.dol</label><div class="flex"><input type="text" id="main-dol-path" class="flex-grow p-2 border border-slate-300 rounded-l-md" placeholder="Select your legally extracted main.dol file" readonly><button id="select-file-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-r-md hover:bg-indigo-700">Select File</button></div></div>
                                </div>
                            </div>
                            <div class="pt-2"><button id="run-setup-btn" class="w-full bg-green-600 text-white px-4 py-3 rounded-md hover:bg-green-700 font-bold text-lg">2. Configure Environment & Run Setup</button></div>
                        </div>
                    </div>
                </div>

                <!-- View: Decompilation -->
                <div id="view-decomp" class="hidden">
                     <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md">
                             <h2 class="text-2xl font-semibold mb-4">Find a Target</h2>
                            <div class="mb-4">
                                <div class="flex justify-between items-center mb-1">
                                    <label class="block text-sm font-medium text-slate-700">Select Assembly File</label>
                                    <div class="flex items-center">
                                        <input id="hide-completed-checkbox" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked>
                                        <label for="hide-completed-checkbox" class="ml-2 block text-sm text-gray-900">Hide Completed</label>
                                    </div>
                                </div>
                                <div id="asm-file-select" class="custom-select-container">
                                    <div class="custom-select-value" data-value="">
                                        <span>-- Select project folder first --</span>
                                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </div>
                                    <div class="custom-select-options hidden"></div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1"><h3 class="font-semibold mb-2 text-red-600">Vacant Functions</h3><ul id="vacant-functions" class="h-96 overflow-y-auto border border-slate-200 rounded-md p-2 bg-slate-50"><li class="text-slate-400 italic">Select an assembly file.</li></ul></div>
                            <div class="mt-4"><h3 class="font-semibold mb-2 text-green-600">Claimed/Done Functions</h3><ul id="claimed-functions" class="h-96 overflow-y-auto border border-slate-200 rounded-md p-2 bg-slate-50"><li class="text-slate-400 italic">Select an assembly file.</li></ul></div>
                        </div>
                        <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                            <h2 class="text-2xl font-semibold mb-4">Decompilation Helper</h2>
                            <div class="mb-4">
                                <h3 class="font-semibold">Selected Target (Diff label):</h3>
                                <div class="flex items-center space-x-2">
                                    <p id="selected-target" class="flex-grow p-2 border border-slate-300 rounded-md bg-slate-100 font-mono">None</p>
                                    <button id="refactor-with-ai-btn" class="btn btn-primary" disabled>AI Refactor</button>
                                    <button id="check-decomp-me-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700" disabled>Check</button>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 xl:grid-cols-2 gap-4">
                                <div><h3 class="font-semibold">Target Assembly</h3><p class="text-sm text-slate-500 mb-1">Click a memory access (e.g. <code>0x2C(r3)</code>) to inspect.</p><div id="target-assembly-box" class="h-80 overflow-y-auto w-full p-2 border border-slate-300 rounded-md bg-slate-50 font-mono text-xs" contenteditable="false"></div><button id="copy-assembly-btn" class="w-full mt-2 bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">Copy Assembly Text</button></div>
                                <div><h3 class="font-semibold">Struct Inspector</h3><p class="text-sm text-slate-500 mb-1">Shows possible matches for the selected offset.</p><div id="struct-inspector-box" class="h-80 overflow-y-auto w-full p-2 border border-slate-300 rounded-md bg-slate-50 font-mono text-xs"><p class="text-slate-400 italic">Select an assembly instruction...</p></div><button id="copy-context-btn" class="w-full mt-2 bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">Copy Full Context</button><textarea id="context-box" class="hidden"></textarea></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- View: Build & Verify -->
                <div id="view-build" class="hidden">
                     <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-semibold mb-4">Local Build & Submission</h2>
                        <p class="text-slate-600 mb-6">Once you have a 100% match on decomp.me, paste your C code here to verify it locally and submit your work.</p>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div><label for="matched-code" class="block text-sm font-medium text-slate-700 mb-1">Paste Your Matched C Code Here</label><textarea id="matched-code" rows="10" class="w-full p-2 border border-slate-300 rounded-md font-mono text-sm" placeholder="void un_8031XXXX(void) { /* ... */ }"></textarea><div class="mt-2 flex space-x-2"><button id="inject-code-btn" class="flex-1 bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">Inject Code</button><button id="revert-changes-btn" class="flex-1 bg-slate-600 text-white px-4 py-2 rounded-md hover:bg-slate-700">Revert Changes</button><button id="run-ninja-btn" class="flex-1 bg-green-600 text-white px-4 py-3 rounded-md hover:bg-green-700 font-bold">Run `ninja`</button></div></div>
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200"><h3 class="font-semibold mb-2">Submission</h3><p class="text-sm text-slate-600 mb-4">After a successful local build, open an issue on GitHub.</p><div class="mb-4"><label for="decomp-me-link" class="block text-sm font-medium text-slate-700 mb-1">Link to your decomp.me Scratch</label><input type="text" id="decomp-me-link" class="w-full p-2 border border-slate-300 rounded-md" placeholder="https://decomp.me/scratch/..."></div><button id="submit-github-btn" class="w-full bg-slate-800 text-white px-4 py-2 rounded-md hover:bg-slate-900">Open GitHub Issue</button></div>
                        </div>
                    </div>
                </div>

                <!-- View: Verification Dashboard -->
                <div id="view-dashboard" class="hidden">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex items-center justify-between mb-4"><h2 class="text-2xl font-semibold">Project Status</h2><button id="dashboard-run-report-btn" class="bg-indigo-600 text-white font-bold px-6 py-3 rounded-md hover:bg-indigo-700">Run Verification Report</button></div>
                        <div id="dashboard-summary-section" class="mb-6 hidden"><div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center"><div class="p-4 bg-slate-50 rounded-lg"><p class="text-sm text-slate-500">Overall Progress</p><p id="dashboard-overall-progress" class="text-2xl font-bold">0%</p></div><div class="p-4 bg-slate-50 rounded-lg"><p class="text-sm text-slate-500">Matched Objects</p><p id="dashboard-matched-objects" class="text-2xl font-bold">0 / 0</p></div><div class="p-4 bg-slate-50 rounded-lg"><p class="text-sm text-slate-500">Report Timestamp</p><p id="dashboard-report-timestamp" class="text-2xl font-bold">N/A</p></div></div><div class="mt-4"><div class="progress-bar-bg w-full rounded-full h-4"><div id="dashboard-progress-bar" class="progress-bar h-4 rounded-full" style="width: 0%;"></div></div></div></div>
                        <div id="dashboard-controls-section" class="mb-4 hidden"><input type="text" id="dashboard-filter-input" placeholder="Filter by name..." class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></div>
                        <div id="dashboard-results-container" class="overflow-x-auto"><p id="dashboard-report-placeholder" class="text-center text-slate-500 py-8">Click "Run Verification Report" to start.</p><table id="dashboard-results-table" class="min-w-full divide-y divide-slate-200 hidden"><thead class="bg-slate-50"><tr><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider sortable" data-sort-key="name">Object Name</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider sortable" data-sort-key="match_percent">Match %</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status</th></tr></thead><tbody id="dashboard-table-body" class="bg-white divide-y divide-slate-200"></tbody></table></div>
                    </div>
                </div>
                
                <!-- View: AI Refactor -->
                <div id="view-refactor" class="hidden h-full flex-col">
                    <div class="refactor-container">
                        <div class="refactor-panel"><h2>Target Assembly</h2><pre id="refactor-asm-view" class="refactor-code-view">Loading assembly...</pre></div>
                        <div class="refactor-panel"><h2>Your C Code</h2><textarea id="refactor-c-code-editor">Loading C code...</textarea></div>
                        <div id="refactor-ai-panel" class="refactor-panel">
                            <h2>AI Assistant</h2>
                            <button id="refactor-suggest-btn" class="btn btn-primary mb-4">✨ Suggest Refactoring</button>
                            <div id="refactor-ai-output"><p class="placeholder">Click "Suggest Refactoring" to get an AI-powered suggestion.</p></div>
                            <div class="actions" style="display: none; margin-top: auto;">
                                <button id="refactor-accept-btn" class="btn btn-primary">Accept Suggestion</button>
                                <button id="refactor-dismiss-btn" class="btn btn-secondary">Dismiss</button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 flex space-x-4">
                        <button id="refactor-recompile-btn" class="btn btn-primary flex-grow">Recompile & Verify</button>
                        <div id="refactor-status-bar">Ready</div>
                    </div>
                </div>

                <!-- View: Settings -->
                <div id="view-settings" class="hidden">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-semibold mb-4">Toolchain Configuration</h2>
                        <p class="text-slate-600 mb-6">Manually specify paths to executables if auto-detection fails. The application will prioritize these paths.</p>
                        <div class="space-y-4">
                            <div><label for="settings-python-path" class="block text-sm font-medium text-slate-700 mb-1">Path to python.exe</label><div class="flex"><input type="text" id="settings-python-path" class="flex-grow p-2 border border-slate-300 rounded-l-md" placeholder="e.g., C:\Python39\python.exe" readonly><button data-target-input="settings-python-path" data-filter-name="Python" data-filter-ext="exe" class="browse-exe-btn bg-indigo-600 text-white px-4 py-2 rounded-r-md hover:bg-indigo-700">Browse</button></div></div>
                            <div><label for="settings-git-path" class="block text-sm font-medium text-slate-700 mb-1">Path to git.exe</label><div class="flex"><input type="text" id="settings-git-path" class="flex-grow p-2 border border-slate-300 rounded-l-md" placeholder="e.g., C:\Program Files\Git\bin\git.exe" readonly><button data-target-input="settings-git-path" data-filter-name="Git" data-filter-ext="exe" class="browse-exe-btn bg-indigo-600 text-white px-4 py-2 rounded-r-md hover:bg-indigo-700">Browse</button></div></div>
                            <div><label for="settings-ninja-path" class="block text-sm font-medium text-slate-700 mb-1">Path to ninja.exe</label><div class="flex"><input type="text" id="settings-ninja-path" class="flex-grow p-2 border border-slate-300 rounded-l-md" placeholder="e.g., C:\Python39\Scripts\ninja.exe" readonly><button data-target-input="settings-ninja-path" data-filter-name="Ninja" data-filter-ext="exe" class="browse-exe-btn bg-indigo-600 text-white px-4 py-2 rounded-r-md hover:bg-indigo-700">Browse</button></div></div>
                            <div><label for="settings-objdiff-path" class="block text-sm font-medium text-slate-700 mb-1">Path to objdiff-cli.exe</label><div class="flex"><input type="text" id="settings-objdiff-path" class="flex-grow p-2 border border-slate-300 rounded-l-md" placeholder="Path to the downloaded objdiff-cli executable" readonly><button data-target-input="settings-objdiff-path" data-filter-name="ObjDiff CLI" data-filter-ext="exe" class="browse-exe-btn bg-indigo-600 text-white px-4 py-2 rounded-r-md hover:bg-indigo-700">Browse</button></div></div>
                        </div>
                        <div class="mt-6 flex items-center space-x-4"><button id="save-settings-btn" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 font-semibold">Save Settings</button></div>
                    </div>
                </div>

                <!-- Global Output Console -->
                <div id="output-console-container">
                    <div id="output-console" class="output-console"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="./renderer.js"></script>
</body>
</html>